!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var o in n)("object"==typeof exports?exports:e)[o]=n[o]}}(self,(()=>(()=>{"use strict";var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),e.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var t={};function n(){return n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},n.apply(this,arguments)}e.r(t);const o={c:"c",s:"s",a:"a",m:"m",ctrl:"c",control:"c",shift:"s",alt:"a",meta:"m",ctrlcmd:navigator.userAgent.includes("Macintosh")?"m":"c"},i={arrowup:"up",arrowdown:"down",arrowleft:"left",arrowright:"right",enter:"cr",escape:"esc"," ":"space"};function s(e,t,n=!1){const{c:o,s,a:r,m:l}=t;return(!n||e.length>1)&&(e=e.toLowerCase()),[l&&"m",o&&"c",s&&"s",r&&"a",e=i[e]||e].filter(Boolean).join("-")}function r(e,t=!1){const n=e.split("-"),i=n.pop(),r={};for(const e of n){const t=o[e.toLowerCase()];if(!t)throw new Error(`Unknown modifier key: ${e}`);r[t]=!0}return s(i,r,t)}class l{constructor(){this.children=new Map,this.shortcuts=new Set}add(e,t){let n=this;for(const t of e){let e=n.children.get(t);e||(e=new l,n.children.set(t,e)),n=e}n.shortcuts.add(t)}get(e){let t=this;for(const n of e)if(t=t.children.get(n),!t)return null;return t}remove(e,t){let n=this;const o=[n];for(const t of e){if(n=n.children.get(t),!n)return;o.push(n)}t?n.shortcuts.delete(t):n.shortcuts.clear();let i=o.length-1;for(;i>1&&(n=o[i],!n.shortcuts.size&&!n.children.size);){o[i-1].children.delete(e[i-1]),i-=1}}}class c{constructor(){this._context={},this._conditionData={},this._dataCI=[],this._dataCS=[],this._rootCI=new l,this._rootCS=new l,this.options={sequenceTimeout:500},this._reset=()=>{this._curCI=null,this._curCS=null,this._resetTimer()},this.handleKey=e=>{if(!e.key||e.key.length>1&&o[e.key.toLowerCase()])return;this._resetTimer();const t=s(e.key,{c:e.ctrlKey,a:e.altKey,m:e.metaKey},!0),n=s(e.key,{c:e.ctrlKey,s:e.shiftKey,a:e.altKey,m:e.metaKey});this.handleKeyOnce(t,n,!1)&&(e.preventDefault(),this._reset()),this._timer=setTimeout(this._reset,this.options.sequenceTimeout)}}_resetTimer(){this._timer&&(clearTimeout(this._timer),this._timer=null)}_addCondition(e){let t=this._conditionData[e];if(!t){const n=function(e){return e.split("&&").map((e=>{if(e=e.trim())return"!"===e[0]?{not:!0,field:e.slice(1).trim()}:{not:!1,field:e}})).filter(Boolean)}(e);t={count:0,value:n,result:this._evalCondition(n)},this._conditionData[e]=t}t.count+=1}_removeCondition(e){const t=this._conditionData[e];t&&(t.count-=1,t.count||delete this._conditionData[e])}_evalCondition(e){return e.every((e=>{let t=this._context[e.field];return e.not&&(t=!t),t}))}_checkShortcut(e){const t=e.condition&&this._conditionData[e.condition],n=!t||t.result;e.enabled!==n&&(e.enabled=n,this._enableShortcut(e))}_enableShortcut(e){const t=e.caseSensitive?this._rootCS:this._rootCI;e.enabled?t.add(e.sequence,e):t.remove(e.sequence,e)}enable(){this.disable(),document.addEventListener("keydown",this.handleKey)}disable(){document.removeEventListener("keydown",this.handleKey)}register(e,t,o){const{caseSensitive:i,condition:s}=n({caseSensitive:!1},o),l=function(e,t){return e.split(" ").map((e=>r(e,t)))}(e,i),c=i?this._dataCS:this._dataCI,a={sequence:l,condition:s,callback:t,enabled:!1,caseSensitive:i};return s&&this._addCondition(s),this._checkShortcut(a),c.push(a),()=>{const e=c.indexOf(a);e>=0&&(c.splice(e,1),s&&this._removeCondition(s),a.enabled=!1,this._enableShortcut(a))}}setContext(e,t){this._context[e]=t;for(const e of Object.values(this._conditionData))e.result=this._evalCondition(e.value);for(const e of[this._dataCS,this._dataCI])for(const t of e)this._checkShortcut(t)}handleKeyOnce(e,t,n){var o,i;let s=this._curCS,r=this._curCI;(n||!s&&!r)&&(n=!0,s=this._rootCS,r=this._rootCI),s&&(s=s.get([e])),r&&(r=r.get([t]));const l=[...r?r.shortcuts:[],...s?s.shortcuts:[]].reverse();if(this._curCS=s,this._curCI=r,!(n||l.length||null!=(o=s)&&o.children.size||null!=(i=r)&&i.children.size))return this.handleKeyOnce(e,t,!0);for(const e of l){try{e.callback()}catch(e){}return!0}}}let a;function d(){return a||(a=new c,a.enable()),a}var u=function(e,t,n,o){return new(n||(n=Promise))((function(i,s){function r(e){try{c(o.next(e))}catch(e){s(e)}}function l(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,l)}c((o=o.apply(e,t||[])).next())}))};const h="1px solid lightgray",p=!1,m="8pt",f="0.8",y=window||e.g;function v(){let e=document.getElementById("userscriptlib-container");if(e)return e;{const t=function(){const e=document.createElement("div");return e.style.opacity=f,e.style.left="0",e.style.position="fixed",e.style.top="0",e.style.width="150px",e.style.zIndex="9999",document.body.appendChild(e),e}();let n=p;function o(){i.style.display=n?"none":"block"}!function({panel:e,onClick:t}){const n=document.createElement("div");n.style.backgroundColor="lightgray",n.style.height="12px",e.appendChild(n),n.addEventListener("mousedown",(n=>{n.preventDefault();let o=n.clientX,i=n.clientY,s=!1;const r=t=>{t.preventDefault();const n=o-t.clientX,r=i-t.clientY;o=t.clientX,i=t.clientY,e.style.top=e.offsetTop-r+"px",e.style.left=e.offsetLeft-n+"px",s=!0},l=()=>{document.removeEventListener("mouseup",l),document.removeEventListener("mousemove",r),!s&&t&&t()};document.addEventListener("mouseup",l),document.addEventListener("mousemove",r)}))}({panel:t,onClick:()=>{n=!n,o()}});const i=document.createElement("div");return t.appendChild(i),o(),e=function(e,t){return e=document.createElement("div"),e.id="userscriptlib-container",t.appendChild(e),e}(e,i),function(e){const t=document.createElement("textarea");t.id="userscriptlib-log-pane",t.readOnly=!0,t.rows=5,t.style.all="revert",t.style.boxSizing="border-box",t.style.fontSize=m,t.style.resize="none",t.style.width="100%",t.style.border=h,e.appendChild(t)}(i),e}}function w(e){v();const t=document.getElementById("userscriptlib-log-pane");""!==t.value?t.value+="\n"+e:t.value=e,t.scrollTop=t.scrollHeight}function b(e){return u(this,void 0,void 0,(function*(){const t=()=>{const t=e();return t&&t instanceof HTMLElement&&(t.scrollIntoView(),t.style.backgroundColor="#FDFF47"),t};return new Promise((e=>{const n=t();if(n)return void e(n);const o=new MutationObserver((n=>{const i=t();i&&(e(i),o.disconnect())}));o.observe(document.body,{childList:!0,subtree:!0})}))}))}function g(){if(!GM_xmlhttpRequest)throw new Error('ERROR: please make sure "@grant GM_xmlhttpRequest" is present.')}function _(e=window.document){if(e.body!==e.activeElement&&"IFRAME"!=e.activeElement.tagName)return e.activeElement;for(var t=e.getElementsByTagName("iframe"),n=0;n<t.length;n++){var o=_(t[n].contentWindow.document);if(null!==o)return o}return null}return y.addButton=(e,t,n)=>{const o=document.createElement("button");o.style.backgroundColor="white",o.style.border=h,o.style.color="black",o.style.display="block",o.style.fontSize=m,o.style.margin="0",o.style.padding="0px 10px",o.style.width="100%",o.textContent=e,n&&(o.textContent+=` (${n})`),o.onclick=t,v().appendChild(o),n&&((...e)=>{d().register(...e)})(n,t)},y.addText=(e,{color:t="black"})=>{const n=document.createElement("div");n.textContent=e,n.style.color=t,v().appendChild(n)},y.findElementByXPath=e=>document.evaluate(e,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue,y.findElementBySelector=e=>document.querySelector(e),y.findElementByText=e=>findElementByXPath(`//*[text() = '${e}']`),y.findElementByPartialText=e=>findElementByXPath(`//*[contains(text(),'${e}')]`),y.waitForSelector=e=>b((()=>document.querySelector(e))),y.waitForSelectorAll=e=>b((()=>document.querySelectorAll(e))),y.waitForText=e=>b((()=>findElementByText(e))),y.waitForPartialText=e=>b((()=>findElementByPartialText(e))),y.waitForXPath=e=>b((()=>findElementByXPath(e))),y.saveAsFile=(e,t,n="text/plain")=>{var o=new Blob([e],{type:n});if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(o,t);else{var i=document.createElement("a"),s=URL.createObjectURL(o);i.href=s,i.download=t,document.body.appendChild(i),i.click(),setTimeout((function(){document.body.removeChild(i),window.URL.revokeObjectURL(s)}),0)}},y.download=(e,t)=>{fetch(e).then((e=>e.blob())).then((n=>{const o=document.createElement("a");o.href=URL.createObjectURL(n),o.download=t||e.split("/").pop().split("?")[0],o.click()})).catch(console.error)},y.system=e=>(g(),new Promise((t=>{GM_xmlhttpRequest({method:"POST",url:"http://127.0.0.1:4312/system",responseType:"text",data:JSON.stringify({args:e}),headers:{"Content-Type":"application/json; charset=UTF-8"},onload:e=>{t(e.responseText)}})}))),y.loadData=(e,t={})=>(g(),new Promise((t=>{GM_xmlhttpRequest({method:"POST",url:"http://127.0.0.1:4312/load-data",responseType:"json",data:JSON.stringify({name:e}),headers:{"Content-Type":"application/json; charset=UTF-8"},onload:e=>{t(e.response.data)}})}))),y.saveData=(e,t)=>(g(),new Promise((n=>{GM_xmlhttpRequest({method:"POST",url:"http://127.0.0.1:4312/save-data",responseType:"json",data:JSON.stringify({name:e,data:t}),headers:{"Content-Type":"application/json; charset=UTF-8"},onload:e=>{n(e.response)}})}))),y.openInNewWindow=e=>{window.open(e,"_blank")},y.getSelectedText=()=>window.getSelection().toString().trim().replace(/ /g,"_"),y.sendText=e=>{const t=_();if(t)if(t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement){const[n,o]=[t.selectionStart,t.selectionEnd];t.setRangeText(e,n,o,"end")}else for(let n=0;n<e.length;n++){const o=new KeyboardEvent("keypress",{bubbles:!0,cancelable:!0,keyCode:e.charCodeAt(n)});t.dispatchEvent(o)}},y.click=e=>{const t=function(e,t,n,o){e.dispatchEvent(new MouseEvent(t,{bubbles:!0,cancelable:!0,clientX:n,clientY:o,button:0}))};var n=e.getBoundingClientRect(),o=n.left+(n.right-n.left)/2,i=n.top+(n.bottom-n.top)/2;t(e,"mousedown",o,i),t(e,"mouseup",o,i),t(e,"click",o,i)},y.sendKey=(e,t)=>{const n="string"==typeof t?"key"+t:"keydown",o=document.createEvent("HTMLEvents");o.initEvent(n,!0,!1),o.keyCode=e,document.dispatchEvent(o)},y.sleep=(e,t)=>{const n=Date.now();function o(){const o=t/1e3-((Date.now()-n)/1e3|0),s=o/60|0,r=o%60|0;o<=0?(clearInterval(i),e()):w(`${s<10?"0"+s:s}:${r<10?"0"+r:r}`)}o();const i=setInterval(o,1e3)},y.addNote=(e,t)=>{const n=document.createElement("div");function o(){const t=e.getBoundingClientRect(),o=t.left+window.pageXOffset,i=t.bottom+window.pageYOffset;n.style.left=Math.max(0,o)+"px",n.style.top=Math.max(0,i)+"px"}n.style.position="absolute",n.style.zIndex="9999",n.style.backgroundColor="rgba(255, 255, 0, 0.5)",n.style.color="black",n.style.padding="5px",n.style.fontSize="0.5rem",n.style.pointerEvents="none",n.innerText=t,document.body.appendChild(n),o(),window.addEventListener("resize",o)},y.logd=w,t})()));