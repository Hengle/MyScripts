!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var o in n)("object"==typeof exports?exports:e)[o]=n[o]}}(self,(()=>(()=>{"use strict";var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),e.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var t={};function n(){return n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},n.apply(this,arguments)}e.r(t);const o=navigator.userAgent.includes("Macintosh"),i=["m","c","s","a"],s={ctrl:"c",control:"c",shift:"s",alt:"a",meta:"m",cmd:"m"},r=n({},s,{c:"c",s:"s",a:"a",m:"m",ctrlcmd:o?"m":"c"}),l={arrowup:"up",arrowdown:"down",arrowleft:"left",arrowright:"right",cr:"enter",escape:"esc"," ":"space"};function c(e){const{caseSensitive:t,modifierState:n}=e;let{base:o}=e;(!t||o.length>1)&&(o=o.toLowerCase()),o=l[o]||o;return`${t?"":"i:"}${[...i.filter((e=>n[e])),o].filter(Boolean).join("-")}`}function a(e,t){const n=function(e){const t=e.split(/-(.)/),n=[t[0]];for(let e=1;e<t.length;e+=2)n.push(t[e]+t[e+1]);return n}(e),o=n.pop(),i={};for(const e of n){const t=r[e.toLowerCase()];if(!t)throw new Error(`Unknown modifier key: ${e}`);i[t]=!0}return t&&(t=!(i.a||i.s)),{base:o,modifierState:i,caseSensitive:t}}function d(e){return Array.isArray(e)?e:e.split(/\s+/)}function u(){return{children:new Map,shortcuts:new Set}}function h(e,t,n){let o=e;for(const e of t){let t=o.children.get(e);t||(t=u(),o.children.set(e,t)),o=t}o.shortcuts.add(n)}function f(e,t){let n=e;for(const e of t)if(n=n.children.get(e),!n)break;return n}function m(e,t,n){let o=e;const i=[o];for(const e of t){if(o=o.children.get(e),!o)return;i.push(o)}n?o.shortcuts.delete(n):o.shortcuts.clear();let s=i.length-1;for(;s>1&&(o=i[s],!o.shortcuts.size&&!o.children.size);){i[s-1].children.delete(t[s-1]),s-=1}}class p{constructor(e){this.listeners=[],this.value=e}get(){return this.value}set(e){this.value=e,this.listeners.forEach((t=>t(e)))}subscribe(e){return this.listeners.push(e),e(this.value),()=>this.unsubscribe(e)}unsubscribe(e){const t=this.listeners.indexOf(e);t>=0&&this.listeners.splice(t,1)}}class y{constructor(e){this._context={},this._conditionData={},this._data=[],this._root=u(),this.sequence=new p([]),this._timer=0,this._reset=()=>{this._cur=void 0,this.sequence.set([]),this._resetTimer()},this.handleKey=e=>{if(!e.key||s[e.key.toLowerCase()])return;this._resetTimer();const t=[c({base:e.key,modifierState:{c:e.ctrlKey,m:e.metaKey},caseSensitive:!0}),c({base:e.code,modifierState:{c:e.ctrlKey,s:e.shiftKey,a:e.altKey,m:e.metaKey},caseSensitive:!1}),c({base:e.key,modifierState:{c:e.ctrlKey,s:e.shiftKey,a:e.altKey,m:e.metaKey},caseSensitive:!1})];this.handleKeyOnce(t,!1)&&(e.preventDefault(),this._reset()),this._timer=window.setTimeout(this._reset,this.options.sequenceTimeout)},this.options=n({},y.defaultOptions,e)}_resetTimer(){this._timer&&(window.clearTimeout(this._timer),this._timer=0)}_addCondition(e){let t=this._conditionData[e];if(!t){const n=function(e){return e.split("&&").map((e=>{if(e=e.trim())return"!"===e[0]?{not:!0,field:e.slice(1).trim()}:{not:!1,field:e}})).filter(Boolean)}(e);t={count:0,value:n,result:this._evalCondition(n)},this._conditionData[e]=t}t.count+=1}_removeCondition(e){const t=this._conditionData[e];t&&(t.count-=1,t.count||delete this._conditionData[e])}_evalCondition(e){return e.every((e=>{let t=this._context[e.field];return e.not&&(t=!t),t}))}_checkShortcut(e){const t=e.condition&&this._conditionData[e.condition],n=!t||t.result;e.enabled!==n&&(e.enabled=n,this._enableShortcut(e))}_enableShortcut(e){(e.enabled?h:m)(this._root,e.sequence,e)}enable(){this.disable(),document.addEventListener("keydown",this.handleKey)}disable(){document.removeEventListener("keydown",this.handleKey)}register(e,t,o){const{caseSensitive:i,condition:s}=n({caseSensitive:!1},o),r=function(e,t){return d(e).map((e=>a(e,t)))}(e,i).map((e=>c(e))),l={sequence:r,condition:s,callback:t,enabled:!1,caseSensitive:i};return s&&this._addCondition(s),this._checkShortcut(l),this._data.push(l),()=>{const e=this._data.indexOf(l);e>=0&&(this._data.splice(e,1),s&&this._removeCondition(s),l.enabled=!1,this._enableShortcut(l))}}setContext(e,t){this._context[e]=t;for(const e of Object.values(this._conditionData))e.result=this._evalCondition(e.value);for(const e of this._data)this._checkShortcut(e)}handleKeyOnce(e,t){var n,o;let i=this._cur;if(!t&&i||(t=!0,i=this._root),i){let t;for(const n of e)if(t=f(i,[n]),t){this.sequence.set([...this.sequence.get(),n]);break}i=t}this._cur=i;const[s]=[...(null==(n=i)?void 0:n.shortcuts)||[]];if(!(t||s||null!=(o=i)&&o.children.size))return this._reset(),this.handleKeyOnce(e,!0);if(s){try{s.callback()}catch(e){}return!0}return!1}}let v;function b(){return v||(v=new y,v.enable()),v}y.defaultOptions={sequenceTimeout:500};var w=function(e,t,n,o){return new(n||(n=Promise))((function(i,s){function r(e){try{c(o.next(e))}catch(e){s(e)}}function l(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,l)}c((o=o.apply(e,t||[])).next())}))};const g="1px solid lightgray",E=!1,x="9pt",_="0.8",S=window||e.g;function T(){const e=document.createElement("div");return e.style.all="revert",e.style.opacity=_,e.style.position="fixed",e.style.left="0",e.style.top="0",e.style.zIndex="9999",e.style.border=g,function(){if(!document.getElementById("no-print-style")){const e=document.createElement("style");e.id="no-print-style",e.innerHTML="\n        @media print {\n            .no-print {\n                display: none !important;\n            }\n        }\n      ",document.getElementsByTagName("head")[0].appendChild(e)}}(),e.className="no-print",document.body.appendChild(e),e}function k(){let e=document.getElementById("userscriptlib-container");if(e)return e;{const t=T();let n=E;function o(){i.style.display=n?"none":"block"}!function({panel:e,onClick:t}){const n=document.createElement("div");n.innerText="[userscript]",n.style.fontSize=x,n.style.backgroundColor="lightgray",n.style.userSelect="none",n.style.cursor="default",e.appendChild(n),n.addEventListener("mousedown",(n=>{n.preventDefault();let o=n.clientX,i=n.clientY,s=!1;const r=t=>{t.preventDefault();const n=o-t.clientX,r=i-t.clientY;o=t.clientX,i=t.clientY,e.style.top=e.offsetTop-r+"px",e.style.left=e.offsetLeft-n+"px",s=!0},l=()=>{document.removeEventListener("mouseup",l),document.removeEventListener("mousemove",r),!s&&t&&t()};document.addEventListener("mouseup",l),document.addEventListener("mousemove",r)}))}({panel:t,onClick:()=>{n=!n,o()}});const i=document.createElement("div");return t.appendChild(i),o(),e=function(e,t){return e=document.createElement("div"),e.id="userscriptlib-container",t.appendChild(e),e}(e,i),function(e){const t=document.createElement("textarea");t.id="userscriptlib-log-pane",t.readOnly=!0,t.rows=5,t.style.display="none",t.style.boxSizing="border-box",t.style.fontSize=x,t.style.resize="none",t.style.width="100%",t.style.border=g,e.appendChild(t)}(i),e}}function C(e){k();const t=document.getElementById("userscriptlib-log-pane");t.style.display="block",""!==t.value?t.value+="\n"+e:t.value=e,t.scrollTop=t.scrollHeight}function O(e){return w(this,void 0,void 0,(function*(){const t=()=>{const t=e();return t&&t instanceof HTMLElement&&(t.scrollIntoView(),t.style.backgroundColor="#FDFF47"),t};return new Promise((e=>{const n=t();if(n)return void e(n);const o=new MutationObserver((n=>{const i=t();i&&(e(i),o.disconnect())}));o.observe(document.body,{childList:!0,subtree:!0})}))}))}function L(){if(!GM_xmlhttpRequest)throw new Error('ERROR: please make sure "@grant GM_xmlhttpRequest" is present.')}function P(e=window.document){if(e.body!==e.activeElement&&"IFRAME"!=e.activeElement.tagName)return e.activeElement;for(var t=e.getElementsByTagName("iframe"),n=0;n<t.length;n++){var o=P(t[n].contentWindow.document);if(null!==o)return o}return null}return S.addButton=(e,t,n)=>{const o=document.createElement("button");o.style.backgroundColor="white",o.style.border="none",o.style.color="black",o.style.display="block",o.style.fontSize=x,o.style.margin="0",o.style.padding="0px 8px",o.style.width="100%",o.style.textAlign="left",o.textContent=e,n&&(o.textContent+=` (${n})`),o.onclick=t,k().appendChild(o),n&&((...e)=>{b().register(...e)})(n,t)},S.addText=(e,{color:t="black"})=>{const n=document.createElement("div");n.textContent=e,n.style.color=t,k().appendChild(n)},S.findElementsByXPath=e=>{const t=document.evaluate(e,document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);let n=[];for(let e=0,o=t.snapshotLength;e<o;++e)n.push(t.snapshotItem(e));return n},S.findElementByXPath=e=>document.evaluate(e,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue,S.findElementBySelector=e=>document.querySelector(e),S.findElementByText=e=>findElementByXPath(`//*[text() = '${e}']`),S.findElementsByText=e=>findElementsByXPath(`//*[text() = '${e}']`),S.findElementByPartialText=e=>findElementByXPath(`//*[contains(text(),'${e}')]`),S.waitForSelector=e=>O((()=>document.querySelector(e))),S.waitForSelectorAll=e=>O((()=>document.querySelectorAll(e))),S.waitForText=e=>O((()=>findElementByText(e))),S.waitForPartialText=e=>O((()=>findElementByPartialText(e))),S.waitForXPath=e=>O((()=>findElementByXPath(e))),S.saveTextAsFile=(e,t,n="text/plain")=>{var o=new Blob([e],{type:n});if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(o,t);else{var i=document.createElement("a"),s=URL.createObjectURL(o);i.href=s,i.download=t,document.body.appendChild(i),i.click(),setTimeout((function(){document.body.removeChild(i),window.URL.revokeObjectURL(s)}),0)}},S.download=(e,t)=>{fetch(e).then((e=>e.blob())).then((n=>{const o=document.createElement("a");o.href=URL.createObjectURL(n),o.download=t||e.split("/").pop().split("?")[0],o.click()})).catch(console.error)},S.system=e=>(L(),new Promise((t=>{GM_xmlhttpRequest({method:"POST",url:"http://127.0.0.1:4312/system",responseType:"text",data:JSON.stringify({args:e}),headers:{"Content-Type":"application/json; charset=UTF-8"},onload:e=>{t(e.responseText)}})}))),S.loadData=e=>w(void 0,void 0,void 0,(function*(){const t=yield loadFile(`${e}.json`);return JSON.parse(t)})),S.saveData=(e,t)=>w(void 0,void 0,void 0,(function*(){return saveFile(`${e}.json`,JSON.stringify(t,null,4))})),S.loadFile=e=>(L(),new Promise((t=>{GM_xmlhttpRequest({method:"POST",url:"http://127.0.0.1:4312/load-file",responseType:"json",data:JSON.stringify({file:e}),headers:{"Content-Type":"application/json; charset=UTF-8"},onload:e=>{t(e.response.content)}})}))),S.saveFile=(e,t)=>(L(),new Promise((n=>{GM_xmlhttpRequest({method:"POST",url:"http://127.0.0.1:4312/save-file",responseType:"json",data:JSON.stringify({file:e,content:t}),headers:{"Content-Type":"application/json; charset=UTF-8"},onload:e=>{n(e.response)}})}))),S.openInNewWindow=e=>{window.open(e,"_blank")},S.getSelectedText=()=>{let e="";const t=document.activeElement,n=t?t.tagName.toLowerCase():null;return"textarea"==n||"input"==n&&/^(?:text|search|password|tel|url)$/i.test(t.type)&&"number"==typeof t.selectionStart?e=t.value.slice(t.selectionStart,t.selectionEnd):window.getSelection&&(e=window.getSelection().toString()),e},S.sendText=e=>{const t=P();if(t)if(t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement){const[n,o]=[t.selectionStart,t.selectionEnd];t.setRangeText(e,n,o,"end")}else for(let n=0;n<e.length;n++){const o=new KeyboardEvent("keypress",{bubbles:!0,cancelable:!0,keyCode:e.charCodeAt(n)});t.dispatchEvent(o)}},S.click=e=>{const t=function(e,t,n,o){e.dispatchEvent(new MouseEvent(t,{bubbles:!0,cancelable:!0,clientX:n,clientY:o,button:0}))};var n=e.getBoundingClientRect(),o=n.left+(n.right-n.left)/2,i=n.top+(n.bottom-n.top)/2;t(e,"mousedown",o,i),t(e,"mouseup",o,i),t(e,"click",o,i)},S.sendKey=(e,t)=>{const n="string"==typeof t?"key"+t:"keydown",o=document.createEvent("HTMLEvents");o.initEvent(n,!0,!1),o.keyCode=e,document.dispatchEvent(o)},S.sleep=(e,t)=>{const n=Date.now();function o(){const o=t/1e3-((Date.now()-n)/1e3|0),s=o/60|0,r=o%60|0;o<=0?(clearInterval(i),e()):C(`${s<10?"0"+s:s}:${r<10?"0"+r:r}`)}o();const i=setInterval(o,1e3)},S.highlight=(e,t="👆")=>{e.scrollIntoView({behavior:"auto",block:"center",inline:"center"});const n=document.createElement("div");function o(){const t=e.getBoundingClientRect(),o=t.left+window.pageXOffset,i=t.bottom+window.pageYOffset;n.style.left=Math.max(0,o)+"px",n.style.top=Math.max(0,i)+"px"}n.style.position="absolute",n.style.zIndex="9999",n.style.backgroundColor="rgba(255, 255, 0, 0.5)",n.style.color="black",n.style.padding="5px",n.style.fontSize="0.5rem",n.style.pointerEvents="none",n.innerText=t,document.body.appendChild(n),o(),window.addEventListener("resize",o)},S.logd=C,t})()));